<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> mongoose学习笔记 · zhf的博客</title><meta name="description" content="mongoose学习笔记 - zhf"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/blog/favicon-me.png"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://zzhf.github.com/atom.xml" title="zhf的博客"></head><body><div class="wrap"><header><a href="/blog/" class="logo-link"><img src="/blog/favicon-me.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://weibo.com/p/1005056017789138/home" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/zzhf" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/blog/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">mongoose学习笔记</h1><div class="post-info">Sep 6, 2017</div><div class="post-content"><p>最近在自己鼓捣node.js，尝试着使用express + mongoose搭建自己的web服务器，在这把mongoose的一些收获和知识点记录下来。<br>因为之前一直使用的是java操作MongoDB，对java实体类与Map对象的互转累觉不爱啊。<br><a id="more"></a></p>
<h4 id="Connect-to-MongoDB"><a href="#Connect-to-MongoDB" class="headerlink" title="Connect to MongoDB"></a>Connect to MongoDB</h4><figure class="highlight plain"><figcaption><span>index.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">var mongoose = require(&apos;mongoose&apos;);</div><div class="line">//连接Mongo数据库</div><div class="line">mongoose.connect(&apos;mongodb://localhost/test&apos;); </div><div class="line"></div><div class="line">//监听Mongo首次连接事件</div><div class="line">db.once(&apos;open&apos; ,() =&gt; &#123; </div><div class="line">	console.log(&apos;连接数据库成功&apos;)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">//监听Mongo异常并重连</div><div class="line">db.on(&apos;error&apos;, function(error) &#123;</div><div class="line">    console.error(&apos;Error in MongoDb connection: &apos; + error);</div><div class="line">    mongoose.disconnect();</div><div class="line">&#125;);</div><div class="line"></div><div class="line">db.on(&apos;close&apos;, function() &#123;</div><div class="line">    console.log(&apos;数据库断开，重新连接数据库&apos;);</div><div class="line">    mongoose.connect(config.url, &#123;server:&#123;auto_reconnect:true&#125;&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<h4 id="Schema"><a href="#Schema" class="headerlink" title="Schema"></a>Schema</h4><p>首次接触mongoose的是Schema。Schema可以理解为表结构的定义，虽然mongo并没有表这个概念，类似与java中pojo实体类。<br>定义一个简单的Scheam</p>
<figure class="highlight plain"><figcaption><span>index.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">var mongoose = require(&apos;mongoose&apos;);</div><div class="line">var Schema = mongoose.Schema;</div><div class="line"></div><div class="line">//定义对象blogSchema</div><div class="line">var blogSchema = new Schema(&#123;</div><div class="line">	title: String,</div><div class="line">	author: String,</div><div class="line">	body: String,</div><div class="line">	commets: [&#123;body: String, date: Date&#125;],</div><div class="line">	date: &#123;type: Date, defult: Date.now&#125;,</div><div class="line">	hidden: boolean,</div><div class="line">	meta: &#123;</div><div class="line">		votes: Number,</div><div class="line">		favs: Number</div><div class="line">	&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">//将blogSchema发布为model,并且指定collection名为blog_c;</div><div class="line">var blog = db.model(&apos;blog_c&apos;, blogSchema); </div></pre></td></tr></table></figure>
<p>Scheam只是单纯的定义了mongoDB里面的document结构，通过Scheam可以定义字段的类型、唯一性、索引和验证；</p>
<h4 id="Schema可以定义的字段的类型有："><a href="#Schema可以定义的字段的类型有：" class="headerlink" title="Schema可以定义的字段的类型有："></a>Schema可以定义的字段的类型有：</h4><ul>
<li>String   </li>
<li>Number    </li>
<li>Date        </li>
<li>Buffer    </li>
<li>Boolean    </li>
<li>Mixed        </li>
<li>ObjectId    </li>
<li>Array        </li>
</ul>
<h4 id="一个包含所有类型Schema的实现"><a href="#一个包含所有类型Schema的实现" class="headerlink" title="一个包含所有类型Schema的实现"></a>一个包含所有类型Schema的实现</h4><figure class="highlight plain"><figcaption><span>index.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">var mongoose = require(&apos;mongoose&apos;);</div><div class="line">var Schema = mongoose.Schema;</div><div class="line"></div><div class="line">var blogSchema = new Schema(&#123;</div><div class="line">	title: String,</div><div class="line">	author: String,</div><div class="line">	body: String,</div><div class="line">	commets: [&#123;body: String, date: Date&#125;],</div><div class="line">	date: &#123;type: Date, defult: Date.now&#125;,</div><div class="line">	hidden: boolean,</div><div class="line">	meta: &#123;</div><div class="line">		votes: Number,</div><div class="line">		favs: Number</div><div class="line">	&#125;</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>通过执行node index.js就可以看见你的mongo库里面插入了一条包含各种数据类型的字段的Document记录；</p>
<h4 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h4><p>通过node+mongoose来操作Mongo确实比java来的方便的许多,比较JS原生支持json格式的数据。</p>
</div></article></div></main><footer><div class="paginator"><a href="/blog/2017/09/08/ES6-Coding-Style/" class="prev">PREV</a><a href="/blog/2017/09/02/Start-Blog-Journey/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 - 2017 <a href="https://zzhf.github.com">zhf</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>